#!/usr/bin/env python

import argparse
import subprocess


def main():
    parser = argparse.ArgumentParser('Create the mini reference fasta files for each target')
    parser.add_argument('-t', '--targets', required=True, help='Path to list of HDR targets')
    parser.add_argument('-w', '--workdir', required=True, help='working directory ')

    args = parser.parse_args()

    with open(args.targets) as infile:
        infile.readline()
        for line in infile:
            parts = line.strip().split("\t")
            chrom = parts[1]
            start = parts[4]
            stop = parts[5]
            exonname = parts[0]
            regionstring = chrom + ":" + start + "-" + stop
            outfile = args.workdir + "/" + exonname + ".fa"
            print("samtools faidx %s %s > %s" % ("/net/shendure/vol10/nobackup/genome/fasta/GRCh38.p13.genome.fa",
                                                 regionstring,
                                                 outfile))
            print("bwa index %s" % outfile)
    
    return

if __name__ == '__main__':
    main()
